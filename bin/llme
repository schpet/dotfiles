#!/bin/bash

set -euo pipefail

# Check if an argument was provided
if [[ $# -gt 0 ]]
then
  tempdir=$1
else
  tempdir=$(mktemp -d /tmp/llme-XXXXX)
fi

prompt_file="${tempdir}/prompt.txt"
chat_file="${tempdir}/llm-chat.markdown"

vim "$prompt_file"

# check if the file was written by vim
if [ ! -s "$prompt_file" ]
then
  exit 1
fi

# write the outputs to both the markdown file and stdout
echo "Prompt" | tee -a "$chat_file"
echo "================================================================================" | tee -a "$chat_file"
echo | tee -a "$chat_file"
cat "$prompt_file" | tee -a "$chat_file"
echo | tee -a "$chat_file"

echo "Response" | tee -a "$chat_file"
echo "================================================================================" | tee -a "$chat_file"
echo | tee -a "$chat_file"
cat "$prompt_file" | llm | tee -a "$chat_file"

echo 
echo "Path"
echo "================================================================================"
echo 
echo "$tempdir"
echo "$prompt_file"
echo "$chat_file"


